env:
  PYPI_URL: https://upload.pypi.org/legacy/
language: java
dist: trusty
jdk:
- oraclejdk8
cache:
  directories:
  - "$HOME/.m2"
  - "$HOME/.cache/pip"
branches:
  only:
  - master
  - /^branch-.*$/
  - /^v\d+\..*$/
# command to install dependencies
install:
  - source ~/virtualenv/python2.7/bin/activate
  - python --version
  - dev/py-setup.sh
script: 
  - dev/travis-build.sh
before_deploy: 
  - dev/travis-py-dist.sh
  - dev/travis-prepare-s3-release.sh
deploy:
  - provider: script
    script: dev/travis-py-pypi.sh
    skip_cleanup: true
    on:
      tags: true
  - provider: s3
    access_key_id: "$AWS_ACCESS_KEY"
    secret_access_key: "$AWS_SECRECT_KEY"
    bucket: variant-spark
    local-dir: target/s3-release
    skip_cleanup: true
    acl: public_read
    region: ap-southeast-2
    on:
      tags: true
